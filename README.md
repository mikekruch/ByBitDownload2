# ByBit Downloader

Программа для загрузки исторических данных криптовалют с биржи ByBit в базу данных PostgreSQL.

## Возможности

- Загрузка исторических данных криптовалют с биржи ByBit
- Выбор периода загрузки с точностью до минуты
- Фильтрация и сортировка тикеров
- Пометка тикеров для загрузки
- Асинхронная загрузка с ограничением количества потоков
- Автоматическая проверка существующих данных в базе
- Сохранение настроек и помеченных тикеров
- Прогресс-бар и строка состояния
- **Безопасное хранение паролей с шифрованием**

## Требования

- Python 3.8+
- PostgreSQL
- Windows 10/11

## Установка

1. Клонируйте репозиторий или скачайте файлы
2. Установите зависимости:
```bash
pip install -r requirements.txt
```

## Настройка

1. Запустите программу:
```bash
python main.py
```

2. Нажмите кнопку "Настройка" и заполните параметры подключения к базе данных:
   - Host: адрес сервера PostgreSQL
   - Port: порт (обычно 5432)
   - User: имя пользователя
   - Password: пароль (будет зашифрован при сохранении)
   - Database: имя базы данных
   - Schema: схема (обычно public)
   - Число потоков скачивания: количество одновременных запросов к API

3. Нажмите "Сохранить настройки"

## Безопасность

- **Шифрование паролей**: Пароли базы данных автоматически шифруются перед сохранением в файл настроек
- **Соль**: Для шифрования используется уникальная соль, хранящаяся в файле `salt.key`
- **Алгоритм**: Используется Fernet (AES-128 в режиме CBC) с PBKDF2 для генерации ключа
- **Защита файлов**: Файл с солью (`salt.key`) исключен из системы контроля версий

## Использование

1. **Выбор периода**: Укажите начальную и конечную дату/время загрузки
2. **Фильтрация тикеров**: Введите текст в поле фильтра и нажмите "Фильтр"
3. **Пометка тикеров**: Кликните по тикерам для пометки, используйте кнопки "Пометить все", "Снять все", "Инверсия"
4. **Сортировка**: Кликните по заголовкам столбцов для сортировки
5. **Загрузка**: Нажмите "Загрузить" для начала загрузки данных
6. **Отслеживание**: Следите за прогрессом в прогресс-баре и строке состояния

## Структура базы данных

Для каждого тикера создается таблица `klines_{symbol.lower()}` со структурой:
- timestamp TIMESTAMP PRIMARY KEY
- open DECIMAL
- high DECIMAL  
- low DECIMAL
- close DECIMAL
- volume DECIMAL
- turnover DECIMAL

## Файлы настроек

- `settings.ini` - настройки подключения к базе данных и помеченные тикеры
- `salt.key` - файл с солью для шифрования паролей (создается автоматически)
- `bybit_downloader.log` - лог файл с информацией о работе программы

## Особенности

- Программа загружает данные таймфреймом 1 минута
- Данные загружаются блоками по 600 минут
- При ошибках API выполняется до 3 попыток с паузой 2 секунды
- Программа проверяет существующие данные и загружает только недостающие
- Поддерживается выделение диапазона тикеров с зажатой клавишей Shift
- **Пароли автоматически шифруются при сохранении и дешифруются при загрузке**

## Устранение неполадок

1. **Ошибка подключения к базе данных**: Проверьте настройки подключения
2. **Ошибка API**: Проверьте интернет-соединение и доступность API ByBit
3. **Медленная загрузка**: Уменьшите количество потоков в настройках
4. **Недостаточно памяти**: Уменьшите период загрузки или количество тикеров
5. **Проблемы с шифрованием**: Убедитесь, что файл `salt.key` не поврежден и доступен для чтения 